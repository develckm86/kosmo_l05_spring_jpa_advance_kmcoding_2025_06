<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/layout}"
      th:with="pageTitle='정보 리스트'">
<head></head>
<body>
<div layout:fragment="content">
    <div class="d-flex align-items-center justify-content-between mb-3">
        <h1 class="h3 mb-0 fw-semibold">
            <span th:text="${category?.name}"></span>
            정보 리스트
        </h1>
        <a class="btn btn-primary" href="/info/write.do">글 작성</a>
    </div>

    <form class="card mb-3" th:action="@{/info/list.do}" method="get">
        <div class="card-body">
            <div class="row g-2 align-items-end">
                <div class="col-12 col-md-3">
                    <label class="form-label mb-1" for="fieldSelect">검색 대상</label>
                    <select class="form-select" id="fieldSelect" name="field" aria-label="검색 대상">
                        <option value="title" th:selected="${param.field == 'title'}">제목</option>
                        <option value="content" th:selected="${param.field == 'content'}">내용</option>
                        <option value="nickname" th:selected="${param.field == 'nickname'}">작성자 닉네임</option>
                        <option value="createdAt" th:selected="${param.field == 'createdAt'}">작성일(YYYY-MM-DD)</option>
                    </select>
                </div>
                <div class="col-12 col-md-7">
                    <label class="form-label mb-1" for="searchInput">검색어</label>
                    <input type="text"
                           class="form-control"
                           id="searchInput"
                           name="search"
                           placeholder="검색어를 입력하세요"
                           th:value="${param.search}" />
                </div>
                <div class="col-12 col-md-2 d-grid">
                    <button type="submit" class="btn btn-outline-primary">검색</button>
                </div>
            </div>
        </div>
    </form>
    <div class="m-2 d-flex justify-content-between align-items-center">
        <div class="small text-muted">
            <span class="me-2">page : <th:block th:text="${infoPostPage.number+1}"></th:block></span>
            <span>total : <th:block th:text="${infoPostPage.totalPages}"></th:block></span>
        </div>
        <div class="nav nav-pills gap-2">
            <a class="btn btn-sm btn-outline-dark"
               th:classappend="${#strings.equals(infoPostPage.size,'10')} ? ' active' : ''"
               th:href="@{/info/list.do(sort=${param.sort}, field=${param.field}, search=${param.search}, categoryId=${param.categoryId}, page=${param.page}, size=${10})}">
                10
            </a>
            <a class="btn btn-sm btn-outline-dark"
               th:classappend="${#strings.equals(infoPostPage.size,'20')} ? ' active' : ''"
               th:href="@{/info/list.do(sort=${param.sort}, field=${param.field}, search=${param.search}, categoryId=${param.categoryId}, page=${param.page}, size=${20})}">
                20
            </a>
            <a class="btn btn-sm btn-outline-dark"
               th:classappend="${#strings.equals(infoPostPage.size,'30')} ? ' active' : ''"
               th:href="@{/info/list.do(sort=${param.sort}, field=${param.field}, search=${param.search}, categoryId=${param.categoryId}, page=${param.page}, size=${30})}">
                30
            </a>
            <a class="btn btn-sm btn-outline-dark"
               th:classappend="${#strings.equals(infoPostPage.size,'40')} ? ' active' : ''"
               th:href="@{/info/list.do(sort=${param.sort}, field=${param.field}, search=${param.search}, categoryId=${param.categoryId}, page=${param.page}, size=${40})}">
                40
            </a>
        </div>
    </div>
    <section class="card">
        <!--
        ${ param.sort!=null && !param.sort[0].isEmpty() ? param.sort[0] : 'createdAt,desc'}"
        ${ parm.sort!=null && param.sort[0] ?: 'createdAt,desc'}  ?: Elvis연산자 (공백이 아니면 사용 아니면 'createdAt,desc')
        ${ #strings.defaultString(param.sort, 'createdAt,desc')}   #strings.defaultString  (null이 아니고 공백이 아니면 사용 아니면 'createdAt,desc')

        -->
        <div class="card-header d-flex flex-wrap align-items-center justify-content-between gap-2 bg-light"
             th:with="currentSort=${ #strings.defaultString(param.sort, 'createdAt,desc')}"
        >
            <h2 class="h5 mb-0">목록</h2>
            <div class="d-flex flex-wrap align-items-center">
                <div class="nav nav-pills gap-2">
                    <a class="btn btn-sm btn-outline-secondary"
                       th:classappend="${ #strings.equals(currentSort,'createdAt,desc')} ? 'active' "
                       th:href="@{/info/list.do(sort='createdAt,desc', field=${param.field}, search=${param.search}, categoryId=${param.categoryId}, page=${param.page}, size=${param.size})}">
                        최신순
                    </a>
                    <a class="btn btn-sm btn-outline-secondary"
                       th:classappend="${#strings.equals(currentSort,'createdAt,asc')} ? 'active' "
                       th:href="@{/info/list.do(sort='createdAt,asc', field=${param.field}, search=${param.search}, categoryId=${param.categoryId}, page=${param.page}, size=${param.size})}">
                        오래된순
                    </a>
                    <a class="btn btn-sm btn-outline-secondary"
                       th:classappend="${#strings.equals(currentSort,'commentCount,desc')} ? 'active' "
                       th:href="@{/info/list.do(sort='commentCount,desc', field=${param.field}, search=${param.search}, categoryId=${param.categoryId}, page=${param.page}, size=${param.size})}">
                        댓글 많은 순
                    </a>
                    <a class="btn btn-sm btn-outline-secondary"
                       th:classappend="${#strings.equals(currentSort,'likeCount,desc')} ? 'active' "
                       th:href="@{/info/list.do(sort='likeCount,desc', field=${param.field}, search=${param.search}, categoryId=${param.categoryId}, page=${param.page}, size=${param.size})}">
                        좋아요 많은 순
                    </a>
                </div>
            </div>

        </div>
        <div class="card-body">
            <div th:replace="~{comment/list :: commentList(infoPostPage=${infoPostPage})}"></div>
        </div>
        <div class="card-footer">
            <!--
                  현재 페이지가  5이면 앞뒤로 2개씩 보이게 하는 코드  3 4 [5] 6 7
                  현재 페이지가 1 이면 0 이하가 보임  -1 0 [1] 2 3  => page - 2 < 0 ? 0 : page - 2
                  현재 페이지가 마지막 페이지면이면  last+2가 포임    5 6 [7:last] 8 9   => page + 2 > last ? last : page + 2
                  -->
            <div class="d-flex justify-content-center my-2"
                 th:if="${infoPostPage.totalPages > 0}"
                 th:with="  page=${infoPostPage.number},
                            last=${infoPostPage.totalPages}-1,
                            size=${infoPostPage.size}">
                <nav aria-label="페이지 이동"
                     th:with="  start=${ page - 2 < 0 ? 0 : page - 2 },
                                end=${ page + 2 > last ? last : page + 2 }">
                    <ul class="pagination mb-0">
                        <li class="page-item" th:classappend="${infoPostPage.first} ? ' disabled'">
                            <a class="page-link"
                               th:href="@{/info/list.do (page=${0}, size=${infoPostPage.size}, sort=${currentSort}, field=${param.field}, search=${param.search}, categoryId=${param.categoryId})}"
                               aria-label="처음">first</a>
                        </li>
                        <li class="page-item" th:classappend="${infoPostPage.first} ? ' disabled'">
                            <a class="page-link"
                               th:href="@{/info/list.do (page=${page - 1}, size=${infoPostPage.size}, sort=${currentSort}, field=${param.field}, search=${param.search}, categoryId=${param.categoryId})}"
                               aria-label="이전">«</a>
                        </li>
                        <li class="page-item"
                            th:each="pageNum : ${#numbers.sequence(start, end)}"
                            th:classappend="(${pageNum} == ${page} ? ' active')">
                            <a class="page-link"
                               th:text="${pageNum + 1}"
                               th:href="@{/info/list.do (page=${pageNum}, size=${size}, sort=${currentSort}, field=${param.field}, search=${param.search}, categoryId=${param.categoryId})}"></a>
                        </li>
                        <li class="page-item" th:classappend="${infoPostPage.last} ? ' disabled'">
                            <a class="page-link"
                               th:href="@{/info/list.do (page=${page + 1}, size=${size}, sort=${currentSort}, field=${param.field}, search=${param.search}, categoryId=${param.categoryId})}"
                               aria-label="다음">»</a>
                        </li>
                        <li class="page-item" th:classappend="${infoPostPage.last} ? ' disabled'">
                            <a class="page-link"
                               th:href="@{/info/list.do (page=${last}, size=${size}, sort=${currentSort}, field=${param.field}, search=${param.search}, categoryId=${param.categoryId})}"
                               aria-label="마지막">last</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </section>
</div>
</body>
</html>
